<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>äº®ç¿æœ‰é™å…¬å¸ï½œå±…å®¶æ¸…æ½”ãƒ»ç»ç’ƒæ¸…æ´—ãƒ»æ¸…æ½”ç”¨å“</title>
  <meta name="description" content="äº®ç¿æœ‰é™å…¬å¸æä¾›å±…å®¶æ¸…æ½”ã€ç»ç’ƒæ¸…æ´—æœå‹™ï¼Œä¸¦è²©å”®åš´é¸æ¸…æ½”ç”¨å“ã€‚çµ±ä¸€ç·¨è™Ÿï¼š60778373ã€‚" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#15aabf;/* teal */
      --brand-dark:#0b7285;
      --ink:#1f2937;
      --muted:#6b7280;
      --bg:#f8fafc;
      --surface:#ffffff;
      --ok:#2f9e44;
      --warn:#f08c00;
      --danger:#d9480f;
      --radius:16px;
    }
    *{box-sizing:border-box}
    html,body{margin:0;font-family:"Noto Sans TC",system-ui,-apple-system,Segoe UI,Roboto; color:var(--ink); background:var(--bg)}
    a{color:var(--brand);text-decoration:none}
    header{position:sticky;top:0;background:rgba(255,255,255,.85);backdrop-filter:saturate(180%) blur(10px); border-bottom:1px solid #eef2f7; z-index:50}
    .nav{max-width:1100px;margin:auto;display:flex;align-items:center;gap:20px;padding:12px 16px}
    .logo{font-weight:900;letter-spacing:1px}
    .nav a{padding:8px 10px;border-radius:10px;color:var(--ink)}
    .nav a:hover{background:#eef7fa}
    .spacer{flex:1}
    .btn{display:inline-flex;align-items:center;gap:.5rem;padding:.7rem 1rem;border-radius:12px;border:1px solid #dbe7ee;background:#fff;cursor:pointer;font-weight:600}
    .btn.primary{background:var(--brand);color:#fff;border-color:var(--brand)}
    .btn.primary:hover{background:var(--brand-dark)}
    .btn.ghost{background:transparent}
    .container{max-width:1100px;margin:auto;padding:28px 16px}
    .hero{display:grid;grid-template-columns:1.1fr .9fr;gap:24px;align-items:center}
    .heroCard{background:linear-gradient(135deg,#e6fcf5,#e3fafc);padding:28px;border-radius:var(--radius);box-shadow:0 8px 24px rgba(16,24,40,.06)}
    .hero h1{margin:.2em 0 .4em;font-size:clamp(28px,4vw,40px)}
    .hero p{color:var(--muted);font-size:1.05rem}
    .kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:16px}
    .kpi{background:var(--surface);border:1px solid #e6eef4;padding:16px;border-radius:12px;text-align:center}
    .kpi b{font-size:1.3rem}
    .cardGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:16px}
    .card{background:var(--surface);border:1px solid #e6eef4;border-radius:var(--radius);padding:18px;box-shadow:0 6px 16px rgba(16,24,40,.05)}
    .card h3{margin:.2em 0 .4em}
    .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#e7f7fb;color:var(--brand-dark);font-size:.85rem}
    .price{font-weight:800;font-size:1.2rem}
    .muted{color:var(--muted)}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .list{margin:0;padding-left:18px}
    .surface{background:var(--surface);border:1px solid #e6eef4;border-radius:var(--radius);padding:18px}
    footer{margin-top:40px;background:#0b7285;color:#e6f4f7}
    footer .container{display:grid;grid-template-columns:2fr 1fr 1fr;gap:16px}
    footer a{color:#e6f4f7}
    .tiny{font-size:.9rem}
    /* Cart */
    .cart{position:fixed;right:16px;bottom:16px;z-index:60}
    .cartPanel{position:fixed;right:16px;bottom:84px;width:min(420px,92vw);max-height:70vh;overflow:auto;background:#fff;border:1px solid #dbe7ee;border-radius:16px;box-shadow:0 18px 42px rgba(2, 55, 77, .18);display:none}
    .cartPanel.open{display:block}
    .cartItem{display:grid;grid-template-columns:1fr auto auto;align-items:center;gap:10px;padding:10px 14px;border-bottom:1px dashed #eef2f7}
    .qtyCtrl{display:flex;gap:6px;align-items:center}
    .qtyBtn{width:28px;height:28px;border-radius:7px;border:1px solid #cfe3ea;background:#f6fbfd;cursor:pointer}
    .totals{display:flex;justify-content:space-between;align-items:center;padding:12px 14px}
    .input, select, textarea{width:100%;padding:10px 12px;border:1px solid #dbe7ee;border-radius:10px}
    form .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .sectionTitle{display:flex;justify-content:space-between;align-items:flex-end;margin-bottom:8px}
    .badge{background:#ecfdf5;color:#147d50;padding:4px 8px;border-radius:999px;font-size:.85rem}
    @media (max-width:900px){
      .hero{grid-template-columns:1fr}
      .cardGrid{grid-template-columns:1fr 1fr}
      footer .container{grid-template-columns:1fr}
    }
    @media (max-width:640px){
      .cardGrid{grid-template-columns:1fr}
      form .row{grid-template-columns:1fr}
    }
    /* Toast */
    #toast{position:fixed;left:50%;bottom:20px;transform:translateX(-50%);background:#0b7285;color:#e6f4f7;padding:10px 14px;border-radius:999px;box-shadow:0 8px 24px rgba(0,0,0,.15);opacity:0;pointer-events:none;transition:opacity .3s;z-index:90;font-size:.95rem}
    #toast.show{opacity:1}
    /* Confirmation Overlay */
    #confirmationMessage{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:100;align-items:center;justify-content:center}
    #confirmationMessage .box{background:#0b7285;color:#e6f4f7;padding:24px 28px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25);max-width:92vw}
    #confirmationMessage .box h3{margin:0 0 .4rem}
    #confirmationMessage .box p{margin:.2rem 0 0}
  </style>

  <script>
    /* å…¨åŸŸéŒ¯èª¤æ””æˆªï¼ˆè‹¥æœ‰éŒ¯èª¤ï¼Œç•«é¢å·¦ä¸‹è§’æœƒé¡¯ç¤ºï¼‰ */
    window.addEventListener('error', function(e){
      const box = document.createElement('div');
      box.style.cssText = 'position:fixed;left:12px;bottom:12px;max-width:92vw;background:#fee2e2;color:#991b1b;padding:10px 12px;border:1px solid #fecaca;border-radius:10px;z-index:9999;font-family:ui-monospace,Menlo,monospace;font-size:12px;white-space:pre-wrap;box-shadow:0 6px 18px rgba(0,0,0,.15)';
      box.textContent = '[Error] ' + (e.message||'Uncaught error');
      document.body.appendChild(box);
      setTimeout(()=> box.remove(), 6000);
    });
    window.addEventListener('unhandledrejection', function(e){
      const box = document.createElement('div');
      box.style.cssText = 'position:fixed;left:12px;bottom:12px;max-width:92vw;background:#fef3c7;color:#92400e;padding:10px 12px;border:1px solid #fde68a;border-radius:10px;z-index:9999;font-family:ui-monospace,Menlo,monospace;font-size:12px;white-space:pre-wrap;box-shadow:0 6px 18px rgba(0,0,0,.15)';
      box.textContent = '[Promise] ' + (e.reason && (e.reason.stack||e.reason.message) || 'Unhandled rejection');
      document.body.appendChild(box);
      setTimeout(()=> box.remove(), 6000);
    });
  </script>
</head>
<body>
  <header>
    <nav class="nav">
      <div class="logo">ğŸ§¼ äº®ç¿æ¸…æ½”</div>
      <a href="#services">æœå‹™é …ç›®</a>
      <a href="#products">æ¸…æ½”ç”¨å“</a>
      <a href="#booking">é ç´„/ä¼°åƒ¹</a>
      <a href="#about">é—œæ–¼æˆ‘å€‘</a>
      <div class="spacer"></div>
      <button class="btn" id="openCartBtn">ğŸ›’ è³¼ç‰©è»Š <span id="cartCount" class="pill" style="margin-left:8px">0</span></button>
      <a class="btn primary" href="#booking">ç«‹å³é ç´„</a>
    </nav>
  </header>

  <main class="container">
    <section class="hero" id="home">
      <div class="heroCard">
        <span class="pill">å±…å®¶æ¸…æ½”ãƒ»ç»ç’ƒæ¸…æ´—ãƒ»æ¸…æ½”ç”¨å“</span>
        <h1>å°ˆæ¥­çœå¿ƒçš„æ¸…æ½”å¤¥ä¼´ï¼Œè®“å®¶å‹™å›æ­¸è¼•é¬†ã€‚</h1>
        <p>äº®ç¿æœ‰é™å…¬å¸æä¾› <b>å±…å®¶æ¸…æ½”</b>ã€<b>ç»ç’ƒæ¸…æ´—</b>ã€<b>å®šæœŸä¿é¤Š</b> èˆ‡ <b>åš´é¸æ¸…æ½”ç”¨å“</b>ã€‚é€æ˜å ±åƒ¹ã€åˆ°åºœæœå‹™ã€ä¿éšªé½Šå…¨ï¼Œè®“æ‚¨æ”¾å¿ƒæŠŠæ•´æ½”äº¤çµ¦æˆ‘å€‘ã€‚</p>
        <div class="kpis">
          <div class="kpi"><b>4.9/5</b><div class="muted">é¡§å®¢å¥½è©•</div></div>
          <div class="kpi"><b>48Hå…§</b><div class="muted">å¿«é€Ÿæ’ç¨‹</div></div>
          <div class="kpi"><b>100%</b><div class="muted">åˆ°åºœè‡ªå‚™å·¥å…·</div></div>
        </div>
        <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
          <a href="#booking" class="btn primary">å–å¾—å ±åƒ¹</a>
          <a href="#products" class="btn">é¸è³¼æ¸…æ½”ç”¨å“</a>
        </div>
      </div>
      <div class="surface">
        <h3 style="margin-top:0">æœ¬æœˆé™å®š</h3>
        <ul class="list">
          <li>é¦–è³¼ã€Œå…¨èƒ½æ¿ƒç¸®æ¸…æ½”åŠ‘ã€ç¬¬äºŒä»¶ <b>5 æŠ˜</b></li>
          <li>é ç´„å±…å®¶æ¸…æ½” 4 å°æ™‚ï¼Œç»ç’ƒæ¸…æ´— <b>9 æŠ˜</b></li>
          <li>æ¶ˆè²»æ»¿ NT$1,200 äº« <b>å…é‹</b></li>
        </ul>
        <p class="tiny muted">æ´»å‹•è‡³æœ¬æœˆæœˆåº•ï¼Œæ•ä¸èˆ‡å…¶ä»–å„ªæƒ ä½µç”¨ã€‚</p>
      </div>
    </section>

    <section id="services" style="margin-top:30px">
      <div class="sectionTitle">
        <h2>æœå‹™é …ç›®</h2>
        <span class="badge">å¯é–‹ç«‹ç™¼ç¥¨</span>
      </div>
      <div class="cardGrid">
        <div class="card">
          <h3>ğŸ  å±…å®¶æ¸…æ½”</h3>
          <p class="muted">åœ°æ¿ã€å»šè¡›ã€ç°å¡µé™¤å¡µã€å®¶é›»è¡¨é¢æ¸…æ½”ç­‰ã€‚è‡ªå‚™å·¥å…·èˆ‡ç’°ä¿æ¸…æ½”åŠ‘ã€‚</p>
          <p class="price">NT$900 / å°æ™‚ / äºº</p>
          <p class="tiny muted">* æœ€å°‘ 3 å°æ™‚èµ·ï¼Œåœè»Šè²»å¦è¨ˆã€‚</p>
          <a href="#booking" class="btn">é ç´„æ­¤æœå‹™</a>
        </div>
        <div class="card">
          <h3>ğŸªŸ ç»ç’ƒæ¸…æ´—</h3>
          <p class="muted">å…§å¤–çª—ã€æ°£çª—ã€ç´—çª—æ¸…æ´—èˆ‡æ°´ç—•è™•ç†ã€‚é«˜æ¨“å¤–ç‰†ä¸å«åŠæ›ä½œæ¥­ã€‚</p>
          <p class="price">NT$60 / åª èµ·</p>
          <p class="tiny muted">* ä¾ç¾å ´é«˜åº¦èˆ‡æ•¸é‡å ±åƒ¹ã€‚</p>
          <a href="#booking" class="btn">é ç´„æ­¤æœå‹™</a>
        </div>
        <div class="card">
          <h3>ğŸ” å®šæœŸåˆ°åºœä¿é¤Š</h3>
          <p class="muted">æ¯é€±ã€é›™é€±æˆ–æ¯æœˆå›ºå®šæ¸…æ½”ï¼Œçœæ™‚åˆçœå¿ƒã€‚é•·ç´„äº«å„ªæƒ ã€‚</p>
          <p class="price">NT$800 / å°æ™‚ / äºº</p>
          <a href="#booking" class="btn">äº†è§£æ–¹æ¡ˆ</a>
        </div>
      </div>
    </section>

    <section id="products" style="margin-top:36px">
      <div class="sectionTitle">
        <h2>æ¸…æ½”ç”¨å“</h2>
        <div class="muted tiny">æ‰€æœ‰åƒ¹æ ¼å«ç¨…ï¼Œæ»¿ NT$1,200 å…é‹</div>
      </div>
      <div class="cardGrid" id="productGrid"></div>
    </section>

    <section id="booking" style="margin-top:36px">
      <h2>é ç´„ / è©¢åƒ¹</h2>
      <div class="grid-2">
        <form id="bookingForm" class="surface">
          <div class="row">
            <div>
              <label>å§“å</label>
              <input class="input" name="name" required placeholder="ç‹å°æ˜" />
            </div>
            <div>
              <label>è¯çµ¡é›»è©±</label>
              <input class="input" name="phone" required placeholder="0912-345-678" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>æœå‹™é …ç›®</label>
              <select name="service" class="input">
                <option value="å±…å®¶æ¸…æ½”">å±…å®¶æ¸…æ½”</option>
                <option value="ç»ç’ƒæ¸…æ´—">ç»ç’ƒæ¸…æ´—</option>
                <option value="å®šæœŸä¿é¤Š">å®šæœŸä¿é¤Š</option>
              </select>
            </div>
            <div>
              <label>æœŸæœ›æ—¥æœŸ</label>
              <input class="input" type="date" name="date" />
            </div>
          </div>
          <label>æœå‹™åœ°å€</label>
          <input class="input" name="address" placeholder="â—‹â—‹å¸‚â—‹â—‹å€â—‹â—‹è·¯â—‹â—‹è™Ÿ" />
          <label>å‚™è¨»</label>
          <textarea class="input" name="note" rows="4" placeholder="å¯é™„ä¸Šçª—æˆ¶æ•¸é‡ã€åªæ•¸ã€æƒ³è™•ç†çš„æ¸…æ½”é‡é»â€¦"></textarea>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
            <button type="submit" class="btn primary">é€å‡ºé ç´„</button>
            <a class="btn ghost" href="#">å›é ‚éƒ¨</a>
          </div>
          <p class="tiny muted">é€å‡ºå¾Œæœƒç”¢ç”Ÿä¸€å°è‰æ“¬ä¿¡ä»¶ï¼Œæ‚¨å¯ç›´æ¥å¯„å‡ºæˆ–ä¿®æ”¹å…§å®¹ï¼Œæˆ‘å€‘å°‡æ–¼ 24 å°æ™‚å…§å›è¦†ã€‚</p>
        </form>
        <div class="surface">
          <h3 style="margin-top:0">æœå‹™æµç¨‹</h3>
          <ol class="list">
            <li>å¡«å¯«é ç´„è³‡æ–™æˆ–è³¼ç‰©è»Šçµå¸³å‚™è¨»</li>
            <li>å®¢æœé›»è©±ç¢ºèªéœ€æ±‚èˆ‡ä¼°åƒ¹</li>
            <li>æ´¾å·¥åˆ°åºœæœå‹™ï¼ˆè‡ªå‚™å·¥å…·ï¼‰</li>
            <li>å®Œå·¥å¾Œé–‹ç«‹ç™¼ç¥¨èˆ‡å›é¥‹å•å·</li>
          </ol>
          <h3>å¸¸è¦‹å•ç­”</h3>
          <p><b>Q.</b> æ˜¯å¦å¯è‡ªå‚™æ¸…æ½”åŠ‘ï¼Ÿ<br><span class="muted">A. å¯ï¼Œæˆ‘å€‘äº¦å¯æä¾›ç’°ä¿é…æ–¹ã€‚</span></p>
          <p><b>Q.</b> é«˜æ¨“å¤–çª—èƒ½æ´—å—ï¼Ÿ<br><span class="muted">A. åœ¨å®‰å…¨å¯åŠç¯„åœå…§å¯è™•ç†ï¼›éœ€åŠæ›è€…è«‹å¦è­°ã€‚</span></p>
          <p><b>Q.</b> æ˜¯å¦é–‹ç«‹ç™¼ç¥¨ï¼Ÿ<br><span class="muted">A. æ˜¯ï¼Œæœ¬å…¬å¸æœ‰ä½¿ç”¨çµ±ä¸€ç™¼ç¥¨ã€‚</span></p>
        </div>
      </div>
    </section>

    <section id="checkout" style="margin-top:36px">
      <div class="sectionTitle">
        <h2>è³¼ç‰©è»Šçµå¸³</h2>
        <span class="muted tiny">ç›®å‰æ¡è²¨åˆ°ä»˜æ¬¾ / è½‰å¸³ï¼Œå¡«å¯«è³‡æ–™å¾Œå°‡ç”±å°ˆå“¡èˆ‡æ‚¨ç¢ºèªã€‚</span>
      </div>
      <div class="grid-2">
        <div class="surface">
          <h3 style="margin-top:0">è¨‚å–®æ‘˜è¦</h3>
          <div id="orderSummary"></div>
        </div>
        <form id="checkoutForm" class="surface">
          <div class="row">
            <div>
              <label>å§“å</label>
              <input class="input" name="name" required />
            </div>
            <div>
              <label>é›»è©±</label>
              <input class="input" name="phone" required />
            </div>
          </div>
          <label>æ”¶ä»¶åœ°å€</label>
          <input class="input" name="address" required />
          <label>å‚™è¨»</label>
          <textarea class="input" name="note" rows="4" placeholder="çµ±ä¸€ç·¨è™Ÿã€ç™¼ç¥¨æŠ¬é ­ã€åˆ°è²¨æ™‚æ®µåå¥½â€¦"></textarea>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:12px">
            <button type="submit" class="btn primary">é€å‡ºè¨‚å–®</button>
            <button type="button" class="btn" id="clearCart">æ¸…ç©ºè³¼ç‰©è»Š</button>
          </div>
          <p class="tiny muted">è«‹è©³ç´°ç¢ºèªè¨‚è³¼å…§å®¹ï¼Œé€å‡ºè¨‚å–®å¾Œæ•ç„¡æ³•ä¿®æ”¹ã€‚</p>
        </form>
      </div>
    </section>
  </main>

  <div class="cart">
    <div class="cartPanel" id="cartPanel">
      <div style="display:flex;justify-content:space-between;align-items:center;padding:12px 14px;border-bottom:1px solid #eef2f7">
        <b>è³¼ç‰©è»Š</b>
        <button class="btn" id="closeCartBtn">é—œé–‰</button>
      </div>
      <div id="cartItems"></div>
      <div class="totals">
        <div>
          <div class="muted tiny">å°è¨ˆ</div>
          <div id="cartSubtotal" class="price">NT$0</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <a class="btn" href="#checkout" id="goCheckout">å‰å¾€çµå¸³</a>
          <button class="btn" id="clearCart2">æ¸…ç©º</button>
        </div>
      </div>
    </div>
  </div>

  <footer id="about">
    <div class="container">
      <div>
        <h3 style="margin-top:0">ğŸ§½ äº®ç¿æœ‰é™å…¬å¸</h3>
        <p class="tiny">çµ±ä¸€ç·¨è™Ÿï¼š<b>60778373</b><br/>æœå‹™ä¿¡ç®±ï¼šservice@liangrui.example<br/>æœå‹™æ™‚é–“ï¼šé€±ä¸€ï½é€±å…­ 09:00â€“18:00</p>
        <p class="tiny">Â© <span id="year"></span> äº®ç¿æœ‰é™å…¬å¸ï¼Liang-Rui</p>
      </div>
      <div>
        <h4>å¿«é€Ÿå°è¦½</h4>
        <p class="tiny"><a href="#services">æœå‹™é …ç›®</a>ï½œ<a href="#products">æ¸…æ½”ç”¨å“</a>ï½œ<a href="#booking">é ç´„</a>ï½œ<a href="#checkout">çµå¸³</a></p>
      </div>
      <div>
        <h4>å…¬å¸è³‡è¨Š</h4>
        <p class="tiny">å…¬å¸åç¨±ï¼š<b>äº®ç¿æœ‰é™å…¬å¸</b><br>çµ±ä¸€ç·¨è™Ÿï¼š<b>60778373</b></p>
      </div>
    </div>
  </footer>

  <!-- Toast & Confirmation Overlay -->
  <div id="toast" role="status" aria-live="polite"></div>
  <div id="confirmationMessage" role="dialog" aria-modal="true" aria-labelledby="confirmTitle" aria-describedby="confirmDesc">
    <div class="box">
      <h3 id="confirmTitle">æˆ‘å€‘å·²æ”¶åˆ°æ‚¨çš„è¨‚è³¼ âœ…</h3>
      <p id="confirmDesc">æ„Ÿè¬æ‚¨çš„æ”¯æŒï¼æˆ‘å€‘å°‡ç›¡å¿«èˆ‡æ‚¨é›»è©±ç¢ºèªèˆ‡å‡ºè²¨å®‰æ’ã€‚</p>
      <div style="margin-top:10px;display:flex;gap:8px;justify-content:flex-end">
        <button class="btn" id="confirmCloseBtn">é—œé–‰</button>
      </div>
    </div>
  </div>

  <script>
    // --------- Utilities ---------
    const $ = (sel)=>document.querySelector(sel);
    const $$ = (sel)=>document.querySelectorAll(sel);
    const formatNTD = (n)=>`NT$${n.toLocaleString('zh-TW')}`;

    // --------- Product Data ---------
    const PRODUCTS = [
      {id:'p1', name:'å…¨èƒ½æ¿ƒç¸®æ¸…æ½”åŠ‘ 1L', price:199, unit:'ç“¶', desc:'å»šæˆ¿/åœ°æ¿çš†é©ç”¨ï¼Œä½æ³¡æ˜“æ²–æ´—ã€‚'},
      {id:'p2', name:'ç»ç’ƒäº®å…‰æ°´ 500ml', price:169, unit:'ç“¶', desc:'å¿«é€Ÿå»æ°´ç—•ä¸æ®˜ç•™ï¼Œç„¡é¦™ç²¾ã€‚'},
      {id:'p3', name:'é™¤éœ‰æ¼‚æ½”åŠ‘ 600ml', price:189, unit:'ç“¶', desc:'æµ´å®¤çŸ½åˆ©åº·/ç£ç¸«å°ˆç”¨ï¼Œå…åˆ·é…æ–¹ã€‚'},
      {id:'p4', name:'ç’°ä¿ç”Ÿç‰©é…µç´ é™¤è‡­åŠ‘ 1L', price:239, unit:'ç“¶', desc:'åˆ†è§£ç•°å‘³æºï¼Œå¯µç‰©å‹å–„ã€‚'},
      {id:'p5', name:'æœ¨è³ªåœ°æ¿è­·ç†åŠ‘ 800ml', price:249, unit:'ç“¶', desc:'æº«å’Œä¸å‚·æœ¨ï¼Œå½¢æˆä¿è­·è–„è†œã€‚'},
      {id:'p6', name:'è¶…ç´°çº–ç¶­æŠ¹å¸ƒ (5å…¥)', price:149, unit:'åŒ…', desc:'é«˜å¸æ°´ä¸æ‰æ£‰çµ®ï¼Œä¹¾æ¿•å…©ç”¨ã€‚'},
      {id:'p7', name:'å¯æ›¿æ›æµ·ç¶¿èœç“œå¸ƒ (4å…¥)', price:99, unit:'åŒ…', desc:'é›™é¢æè³ªï¼Œè€åˆ·è€ç”¨ã€‚'},
      {id:'p8', name:'ä¼¸ç¸®ç»ç’ƒåˆ® 28â€“45cm', price:299, unit:'æ”¯', desc:'é«˜è™•ç»ç’ƒæ¸…æ½”å¥½å¹«æ‰‹ã€‚'},
      {id:'p9', name:'ç„¡ç—•æ›å‹¾ (10å…¥)', price:129, unit:'çµ„', desc:'è€é‡ 3kgï¼Œæµ´å®¤å»šæˆ¿çš†å¯ç”¨ã€‚'},
      {id:'p10', name:'æ¿¾ç¶²é›†å¡µç´™ (30å…¥)', price:119, unit:'åŒ…', desc:'é©ç”¨å¤šæ•¸æ’é¢¨æ‰‡å°ºå¯¸ã€‚'}
    ];

    // --------- State ---------
    const CART_KEY = 'liangrui_cart_v1';
    let cart = JSON.parse(localStorage.getItem(CART_KEY) || '[]');

    function saveCart(){ localStorage.setItem(CART_KEY, JSON.stringify(cart)); }

    // --------- Render Products ---------
    function renderProducts(){
      const grid = $('#productGrid');
      grid.innerHTML = PRODUCTS.map(p=>`
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px">
            <h3 style="margin:0">${p.name}</h3>
            <span class="pill">${p.unit}</span>
          </div>
          <p class="muted">${p.desc}</p>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div class="price">${formatNTD(p.price)}</div>
            <button class="btn" onclick="addToCart('${p.id}')">åŠ å…¥è³¼ç‰©è»Š</button>
          </div>
        </div>
      `).join('');
    }

    // --------- Cart Logic ---------
    function addToCart(id){
      const item = cart.find(i=>i.id===id);
      if(item){ item.qty += 1; }
      else{ const p = PRODUCTS.find(x=>x.id===id); cart.push({id:p.id,name:p.name,price:p.price,qty:1}); }
      saveCart();
      renderCart();
      $('#cartPanel').classList.add('open');
    }

    function removeFromCart(id){ cart = cart.filter(i=>i.id!==id); saveCart(); renderCart(); }
    function changeQty(id,delta){ const it = cart.find(i=>i.id===id); if(!it) return; it.qty = Math.max(1, it.qty+delta); saveCart(); renderCart(); }
    function clearCart(){ cart = []; saveCart(); renderCart(); }

    function cartSubtotal(){ return cart.reduce((s,i)=>s+i.price*i.qty,0); }

    function renderCart(){
      $('#cartCount').textContent = cart.reduce((s,i)=>s+i.qty,0);
      const items = $('#cartItems');
      if(cart.length===0){ items.innerHTML = `<div style="padding:18px" class="muted">è³¼ç‰©è»Šç›®å‰æ˜¯ç©ºçš„</div>`; }
      else{
        items.innerHTML = cart.map(i=>`
          <div class="cartItem">
            <div>
              <div><b>${i.name}</b></div>
              <div class="tiny muted">${formatNTD(i.price)} Ã— ${i.qty}</div>
            </div>
            <div class="qtyCtrl">
              <button class="qtyBtn" onclick="changeQty('${i.id}',-1)">âˆ’</button>
              <div>${i.qty}</div>
              <button class="qtyBtn" onclick="changeQty('${i.id}',1)">ï¼‹</button>
            </div>
            <div>
              <button class="btn" onclick="removeFromCart('${i.id}')">ç§»é™¤</button>
            </div>
          </div>
        `).join('');
      }
      $('#cartSubtotal').textContent = formatNTD(cartSubtotal());
      renderOrderSummary();
    }

    // --------- Checkout ---------
    function renderOrderSummary(){
      const box = $('#orderSummary');
      if(cart.length===0){ box.innerHTML = '<p class="muted">å°šç„¡å•†å“ã€‚</p>'; return; }
      const lines = cart.map(i=>`<div style="display:flex;justify-content:space-between"><span>${i.name} Ã— ${i.qty}</span><b>${formatNTD(i.price*i.qty)}</b></div>`).join('');
      const sub = cartSubtotal();
      const ship = sub>=1200?0:100;
      const total = sub+ship;
      box.innerHTML = `
        <div class="surface" style="border:none;padding:0">
          ${lines}
          <hr style="border:none;border-top:1px dashed #e5e7eb;margin:10px 0">
          <div style="display:flex;justify-content:space-between"><span class="muted">å°è¨ˆ</span><span>${formatNTD(sub)}</span></div>
          <div style="display:flex;justify-content:space-between"><span class="muted">é‹è²»</span><span>${ship===0?'<span class="badge">å…é‹</span>':formatNTD(ship)}</span></div>
          <div style="display:flex;justify-content:space-between;font-size:1.1rem;margin-top:6px"><span><b>åˆè¨ˆ</b></span><span><b>${formatNTD(total)}</b></span></div>
        </div>`;
    }

    // Booking form => mailto draft
    $('#bookingForm').addEventListener('submit',(e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      const data = Object.fromEntries(fd.entries());
      const subject = encodeURIComponent(`ã€é ç´„ã€‘${data.service}ï½œ${data.name}`);
      const body = encodeURIComponent(`å§“åï¼š${data.name}\né›»è©±ï¼š${data.phone}\næœå‹™é …ç›®ï¼š${data.service}\næœŸæœ›æ—¥æœŸï¼š${data.date||'-'}\nåœ°å€ï¼š${data.address||'-'}\nå‚™è¨»ï¼š${data.note||'-'}\n\nâ€” ç”±ç¶²ç«™è¡¨å–®é€å‡º`);
      window.location.href = `mailto:service@liangrui.example?subject=${subject}&body=${body}`;
    });

    // Checkout helpers
    function showToast(msg){ const t=$('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2500); }
    function downloadText(filename, text){
      const blob = new Blob([text], {type: 'text/plain;charset=utf-8'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename; document.body.appendChild(a); a.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 0);
    }

    // Checkout form => mailto + fallbacks + confirmation overlay
    $('#checkoutForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      if(cart.length===0){ alert('è³¼ç‰©è»Šæ˜¯ç©ºçš„'); return; }

      const fd = new FormData(e.target);
      const data = Object.fromEntries(fd.entries());
      const lines = cart.map(i=>`${i.name} Ã— ${i.qty} = ${i.price*i.qty}`).join('\n');
      const sub = cartSubtotal();
      const ship = sub>=1200?0:100;
      const total = sub+ship;

      const subject = encodeURIComponent(`ã€ä¸‹å–®ã€‘${data.name}ï½œè¨‚å–®èˆ‡å¯„é€è³‡è¨Š`);
      const plain = `è¨‚è³¼äººï¼š${data.name}\né›»è©±ï¼š${data.phone}\nåœ°å€ï¼š${data.address}\nå‚™è¨»ï¼š${data.note||'-'}\n\nâ€” è¨‚å–®æ˜ç´° â€”\n${lines}\nå°è¨ˆï¼š${sub}\né‹è²»ï¼š${ship}\nåˆè¨ˆï¼š${total}\n\nçµ±ä¸€ç·¨è™Ÿï¼š60778373\nç™¼ç¥¨æŠ¬é ­ï¼šäº®ç¿æœ‰é™å…¬å¸`;
      const body = encodeURIComponent(plain);
      const mailto = `mailto:order@liangrui.example?subject=${subject}&body=${body}`;

      // 1) å˜—è©¦é–‹ä¿¡ä»¶è‰ç¨¿ï¼ˆæ–°åˆ†é ï¼‰ï¼Œ2) è‹¥è¢«æ“‹å‰‡æ”¹ç”¨åŒåˆ†é 
      let opened = false;
      try{ opened = !!window.open(mailto, '_blank'); }catch(err){ /* noop */ }
      if(!opened){ window.location.href = mailto; }

      // 3) ç’°å¢ƒæ²’æœ‰é è¨­ä¿¡ç®± â†’ ä¸‹è¼‰æ˜ç´°ï¼ˆå»¶é²ä¸€é»é¿å…èˆ‡ç€è¦½å™¨å‹•ä½œè¡çªï¼‰
      setTimeout(()=>{ downloadText(`äº®ç¿_è¨‚å–®_${Date.now()}.txt`, plain); }, 400);

      // ä¾éœ€æ±‚ï¼šé€å‡ºå¾Œã€ç«‹åˆ»æ¸…ç©ºè³¼ç‰©è»Šã€‘ã€æ›´æ–° UIã€é¡¯ç¤ºç¢ºèª Overlay
      clearCart();
      renderOrderSummary();
      $('#cartPanel').classList.remove('open');
      e.target.reset();
      $('#confirmationMessage').style.display = 'flex';
      setTimeout(()=>{ $('#confirmationMessage').style.display = 'none'; }, 3000);

      // è‡ªæˆ‘æ¸¬è©¦ï¼šæ¸…ç©ºå¾Œé•·åº¦æ‡‰ç‚º 0
      try{ console.assert(cart.length === 0, '[TEST] cart should be cleared after submit'); }catch(_){}
    });

    // Buttons & toggles
    $('#openCartBtn').addEventListener('click',()=>$('#cartPanel').classList.toggle('open'));
    $('#closeCartBtn').addEventListener('click',()=>$('#cartPanel').classList.remove('open'));
    $('#goCheckout').addEventListener('click',()=>$('#cartPanel').classList.remove('open'));
    $('#clearCart').addEventListener('click',()=>{ if(confirm('ç¢ºå®šæ¸…ç©ºè³¼ç‰©è»Šï¼Ÿ')){ clearCart(); }});
    $('#clearCart2').addEventListener('click',()=>{ if(confirm('ç¢ºå®šæ¸…ç©ºè³¼ç‰©è»Šï¼Ÿ')){ clearCart(); }});
    $('#confirmCloseBtn').addEventListener('click',()=> $('#confirmationMessage').style.display='none');

    // --------- Minimal Self Tests (run once) ---------
    (function runSelfTests(){
      try{
        const bak = JSON.parse(localStorage.getItem(CART_KEY) || '[]');
        cart = []; saveCart();
        addToCart('p1'); addToCart('p1'); addToCart('p2');
        console.assert(cart.length === 2, '[TEST] cart length should be 2');
        console.assert(cartSubtotal() === 199*2 + 169, '[TEST] subtotal calculation');
        console.assert(formatNTD(1200) === 'NT$1,200', '[TEST] formatNTD');
        const sub = cartSubtotal();
        const ship = sub>=1200?0:100;
        console.assert(ship === 100, '[TEST] shipping threshold when subtotal < 1200');
        clearCart();
        console.assert(cart.length === 0, '[TEST] clearCart empties cart');
        cart = bak; saveCart();
      }catch(err){ console.error('[TEST] failed:', err); }
      finally{ renderCart(); }
    })();

    // Init
    renderProducts();
    renderCart();
    $('#year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
